<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Material Unit Calculator</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* Light gray background */
        }
        /* Custom scrollbar for better aesthetics */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #e0e0e0;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        kbd {
            background-color: #eee;
            border-radius: 3px;
            border: 1px solid #b4b4b4;
            box-shadow: 0 1px 1px rgba(0, 0, 0, .2), 0 2px 0 0 rgba(255, 255, 255, .7) inset;
            color: #333;
            display: inline-block;
            font-family: monospace;
            font-size: .8em;
            font-weight: 700;
            padding: 2px 4px;
            white-space: nowrap;
            margin: 0 2px;
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <div class="bg-white p-8 rounded-2xl shadow-xl w-full max-w-2xl border border-gray-200">
        <h1 class="text-3xl font-bold text-gray-800 mb-6 text-center">Material Unit Calculator</h1>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
            <div class="flex flex-col">
                <label for="resins" class="text-lg font-medium text-gray-700 mb-2">Total Resins Needed:</label>
                <div class="flex items-center gap-2">
                    <input type="number" id="resins" placeholder="e.g., 200" class="p-3 border border-gray-300 rounded-lg flex-grow focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200" min="0">
                    <button class="plus-btn bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-200" data-target-input="resins">
                        +
                    </button>
                </div>
            </div>

            <div class="flex flex-col">
                <label for="metals" class="text-lg font-medium text-gray-700 mb-2">Total Metals Needed:</label>
                <div class="flex items-center gap-2">
                    <input type="number" id="metals" placeholder="e.g., 550" class="p-3 border border-gray-300 rounded-lg flex-grow focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200" min="0">
                    <button class="plus-btn bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-200" data-target-input="metals">
                        +
                    </button>
                </div>
            </div>

            <div class="flex flex-col">
                <label for="ceramics" class="text-lg font-medium text-gray-700 mb-2">Total Ceramics Needed:</label>
                <div class="flex items-center gap-2">
                    <input type="number" id="ceramics" placeholder="e.g., 350" class="p-3 border border-gray-300 rounded-lg flex-grow focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200" min="0">
                    <button class="plus-btn bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-200" data-target-input="ceramics">
                        +
                    </button>
                </div>
            </div>

            <div class="flex flex-col">
                <label for="chemicals" class="text-lg font-medium text-gray-700 mb-2">Total Chemicals Needed:</label>
                <div class="flex items-center gap-2">
                    <input type="number" id="chemicals" placeholder="e.g., 180" class="p-3 border border-gray-300 rounded-lg flex-grow focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200" min="0">
                    <button class="plus-btn bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-200" data-target-input="chemicals">
                        +
                    </button>
                </div>
            </div>

            <div class="flex flex-col">
                <label for="specialAlloys" class="text-lg font-medium text-gray-700 mb-2">Total Special Alloys Needed:</label>
                <div class="flex items-center gap-2">
                    <input type="number" id="specialAlloys" placeholder="e.g., 700" class="p-3 border border-gray-300 rounded-lg flex-grow focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200" min="0">
                    <button class="plus-btn bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-200" data-target-input="specialAlloys">
                        +
                    </button>
                </div>
            </div>

            <div class="flex flex-col">
                <label for="chiralCrystals" class="text-lg font-medium text-gray-700 mb-2">Total Chiral Crystals Needed:</label>
                <div class="flex items-center gap-2">
                    <input type="number" id="chiralCrystals" placeholder="e.g., 100" class="p-3 border border-gray-300 rounded-lg flex-grow focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200" min="0">
                    <button class="plus-btn bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-200" data-target-input="chiralCrystals">
                        +
                    </button>
                </div>
            </div>
        </div>

        <button id="calculateBtn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-4 rounded-xl shadow-lg transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-75">
            Calculate Units
        </button>

        <!-- Moved and redesigned results section -->
        <div id="results-container" class="mt-8 grid grid-cols-1 md:grid-cols-2 gap-6">
            <div id="resinsResult" class="bg-blue-50 p-4 rounded-lg border border-blue-200 hidden"></div>
            <div id="metalsResult" class="bg-green-50 p-4 rounded-lg border border-green-200 hidden"></div>
            <div id="ceramicsResult" class="bg-yellow-50 p-4 rounded-lg border border-yellow-200 hidden"></div>
            <div id="chemicalsResult" class="bg-purple-50 p-4 rounded-lg border border-purple-200 hidden"></div>
            <div id="specialAlloysResult" class="bg-red-50 p-4 rounded-lg border border-red-200 hidden"></div>
            <div id="chiralCrystalsResult" class="bg-gray-50 p-4 rounded-lg border border-gray-200 hidden"></div>
        </div>

        <button id="resetBtn" class="w-full bg-gray-400 hover:bg-gray-500 text-white font-semibold py-3 px-4 rounded-xl shadow-lg mt-4 transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-gray-300 focus:ring-opacity-75">
            Reset
        </button>

        <!-- Keyboard Shortcuts Text Below Buttons -->
        <div class="text-center text-gray-600 text-sm mt-4">
            <p>Shortcuts:
                <kbd>Enter</kbd> (Add Dialog: Save)
                <kbd>Esc</kbd> (Add Dialog: Cancel)
                <kbd>R</kbd> (Reset All)
            </p>
        </div>

        <div id="messageModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center hidden z-50">
            <div class="bg-white p-6 rounded-lg shadow-xl max-w-sm w-full text-center">
                <p id="modalMessage" class="text-gray-800 text-lg mb-4"></p>
                <button id="modalCloseBtn" class="bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded-md">OK</button>
            </div>
        </div>

        <div id="addAmountModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center hidden z-50">
            <div class="bg-white p-6 rounded-lg shadow-xl max-w-sm w-full">
                <h3 class="text-xl font-bold text-gray-800 mb-4">Add Amount</h3>
                <input type="number" id="amountToAddInput" placeholder="Enter amount to add" class="p-3 border border-gray-300 rounded-lg w-full mb-4 focus:ring-2 focus:ring-blue-500 focus:border-transparent" min="0">
                <div class="flex justify-end gap-2">
                    <button id="cancelAddAmountBtn" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold py-2 px-4 rounded-md">Cancel</button>
                    <button id="confirmAddAmountBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-md">Add</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Function to display messages in a custom modal instead of alert()
        function showModalMessage(message) {
            const modal = document.getElementById('messageModal');
            const modalMessage = document.getElementById('modalMessage');
            modalMessage.textContent = message;
            modal.classList.remove('hidden');
            document.getElementById('modalCloseBtn').onclick = () => {
                modal.classList.add('hidden');
            };
        }

        // Define unit sizes for each material type (already sorted descending)
        const unitSizes = {
            resins: [320, 160, 80, 40],
            metals: [400, 200, 100, 50],
            ceramics: [320, 160, 80, 40],
            chemicals: [240, 120, 60, 30],
            specialAlloys: [480, 240, 120, 60]
        };

        // Function to calculate units for a given material, ensuring total is met or exceeded
        function calculateUnits(totalAmount, sizes) {
            let currentTotalProvided = 0;
            const unitsBreakdown = {};
            let wasted = 0;

            // Iterate through sizes from largest to smallest to fulfill the totalAmount
            for (const size of sizes) {
                if (size > 0 && currentTotalProvided < totalAmount) {
                    const count = Math.floor((totalAmount - currentTotalProvided) / size);
                    if (count > 0) {
                        unitsBreakdown[size] = (unitsBreakdown[size] || 0) + count;
                        currentTotalProvided += count * size;
                    }
                }
            }

            // If we still haven't met the totalAmount, add one unit of the smallest size
            if (currentTotalProvided < totalAmount) {
                const smallestSize = sizes[sizes.length - 1]; // Smallest unit is the last one in the pre-sorted array
                if (smallestSize > 0) {
                    unitsBreakdown[smallestSize] = (unitsBreakdown[smallestSize] || 0) + 1;
                    currentTotalProvided += smallestSize;
                }
            }

            // Calculate the wasted amount (if any)
            wasted = currentTotalProvided - totalAmount;
            if (wasted < 0) { // Should not ideally happen with the current logic
                wasted = 0;
            }

            return { units: unitsBreakdown, wasted: wasted, totalProvided: currentTotalProvided };
        }

        // Function to format the results for display
        function formatResults(materialDisplayName, result) {
            // Map display names to the actual keys in unitSizes to ensure correct lookup
            const keyMap = {
                "Resins": "resins",
                "Metals": "metals",
                "Ceramics": "ceramics",
                "Chemicals": "chemicals",
                "Special Alloys": "specialAlloys"
            };
            const materialKey = keyMap[materialDisplayName]; // Get the correct key

            // Special handling for Chiral Crystals as they don't have unit sizes
            if (materialDisplayName === "Chiral Crystals") {
                let output = `<p class="text-lg font-semibold text-gray-800">Chiral Crystals Needed:</p>`;
                output += `<p class="text-gray-700 ml-4">${result.totalAmount} units</p>`;
                return output;
            }


            if (!materialKey || !unitSizes[materialKey]) {
                console.error(`Invalid material name or missing unit sizes: ${materialDisplayName}`);
                return `<p class="text-red-600">Error: Could not retrieve unit sizes for ${materialDisplayName}.</p>`;
            }

            let output = `<p class="text-lg font-semibold text-gray-800">${materialDisplayName} Units:</p>`;
            let hasUnits = false;
            // Iterate through the unit sizes defined for the material to ensure order
            const sizesForMaterial = unitSizes[materialKey]; // Use the correct key here

            for (const size of sizesForMaterial) {
                const count = result.units[size] || 0; // Get count, default to 0 if not present
                if (count > 0) {
                    output += `<p class="text-gray-700 ml-4">${count} x ${size} units</p>`;
                    hasUnits = true;
                }
            }

            // If no units were calculated and there's no wasted amount (meaning input was 0 or invalid)
            if (!hasUnits && result.wasted === 0) {
                output += `<p class="text-gray-700 ml-4">No units needed (or total is 0).</p>`;
            }

            // Display wasted amount if greater than zero
            if (result.wasted > 0) {
                output += `<p class="text-red-600 ml-4 font-semibold">Wasted: ${result.wasted} units (total provided exceeds required amount).</p>`;
            }
            return output;
        }

        // Function to reset all inputs and results
        function resetCalculator() {
            document.getElementById('resins').value = '';
            document.getElementById('metals').value = '';
            document.getElementById('ceramics').value = '';
            document.getElementById('chemicals').value = '';
            document.getElementById('specialAlloys').value = '';
            document.getElementById('chiralCrystals').value = ''; // Reset Chiral Crystals input

            const resultDivs = [
                document.getElementById('resinsResult'),
                document.getElementById('metalsResult'),
                document.getElementById('ceramicsResult'),
                document.getElementById('chemicalsResult'),
                document.getElementById('specialAlloysResult'),
                document.getElementById('chiralCrystalsResult') // Reset Chiral Crystals result div
            ];

            resultDivs.forEach(div => {
                div.innerHTML = ''; // Clear content
                div.classList.add('hidden'); // Hide the div
            });
        }

        // --- Modal for adding amount ---
        const addAmountModal = document.getElementById('addAmountModal');
        const amountToAddInput = document.getElementById('amountToAddInput');
        const confirmAddAmountBtn = document.getElementById('confirmAddAmountBtn');
        const cancelAddAmountBtn = document.getElementById('cancelAddAmountBtn');
        let currentTargetInputId = null; // To keep track of which input field the modal is for

        // Function to open the add amount modal
        function openAddAmountModal(targetInputId) {
            currentTargetInputId = targetInputId;
            amountToAddInput.value = ''; // Clear previous input
            addAmountModal.classList.remove('hidden');
            amountToAddInput.focus();
        }

        // Function to close the add amount modal
        function closeAddAmountModal() {
            addAmountModal.classList.add('hidden');
            currentTargetInputId = null;
        }

        // Event listener for confirming amount addition
        confirmAddAmountBtn.addEventListener('click', () => {
            if (currentTargetInputId) {
                const amount = parseInt(amountToAddInput.value) || 0;
                const targetInput = document.getElementById(currentTargetInputId);
                const currentValue = parseInt(targetInput.value) || 0;
                targetInput.value = currentValue + amount;
            }
            closeAddAmountModal();
        });

        // Event listener for canceling amount addition
        cancelAddAmountBtn.addEventListener('click', closeAddAmountModal);

        // Event listeners for all plus buttons
        document.querySelectorAll('.plus-btn').forEach(button => {
            button.addEventListener('click', (event) => {
                const targetInputId = event.target.dataset.targetInput;
                openAddAmountModal(targetInputId);
            });
        });

        // Keyboard shortcuts for the add amount modal
        amountToAddInput.addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                event.preventDefault(); // Prevent default form submission if any
                confirmAddAmountBtn.click(); // Simulate click on confirm button
            }
        });

        addAmountModal.addEventListener('keydown', (event) => {
            if (event.key === 'Escape') {
                event.preventDefault(); // Prevent default browser actions
                cancelAddAmountBtn.click(); // Simulate click on cancel button
            }
        });

        // Keyboard shortcut for reset (pressing 'R')
        document.addEventListener('keydown', (event) => {
            // Check if the key is 'R' or 'r' and if no modal is currently open
            if (event.key.toLowerCase() === 'r' && addAmountModal.classList.contains('hidden') && messageModal.classList.contains('hidden')) {
                event.preventDefault(); // Prevent default browser action (e.g., refreshing page if 'r' is part of a shortcut)
                resetCalculator();
            }
        });


        // Main calculation function
        document.getElementById('calculateBtn').addEventListener('click', () => {
            const resinsInput = parseInt(document.getElementById('resins').value) || 0;
            const metalsInput = parseInt(document.getElementById('metals').value) || 0;
            const ceramicsInput = parseInt(document.getElementById('ceramics').value) || 0;
            const chemicalsInput = parseInt(document.getElementById('chemicals').value) || 0;
            const specialAlloysInput = parseInt(document.getElementById('specialAlloys').value) || 0;
            const chiralCrystalsInput = parseInt(document.getElementById('chiralCrystals').value) || 0; // Get Chiral Crystals input

            // Get result display elements
            const resinsResultDiv = document.getElementById('resinsResult');
            const metalsResultDiv = document.getElementById('metalsResult');
            const ceramicsResultDiv = document.getElementById('ceramicsResult');
            const chemicalsResultDiv = document.getElementById('chemicalsResult');
            const specialAlloysResultDiv = document.getElementById('specialAlloysResult');
            const chiralCrystalsResultDiv = document.getElementById('chiralCrystalsResult'); // Get Chiral Crystals result div

            // Hide all results initially
            [resinsResultDiv, metalsResultDiv, ceramicsResultDiv, chemicalsResultDiv, specialAlloysResultDiv, chiralCrystalsResultDiv].forEach(div => div.classList.add('hidden'));

            // Perform calculations
            const resinsCalc = calculateUnits(resinsInput, unitSizes.resins);
            const metalsCalc = calculateUnits(metalsInput, unitSizes.metals);
            const ceramicsCalc = calculateUnits(ceramicsInput, unitSizes.ceramics);
            const chemicalsCalc = calculateUnits(chemicalsInput, unitSizes.chemicals);
            const specialAlloysCalc = calculateUnits(specialAlloysInput, unitSizes.specialAlloys);

            // Display Chiral Crystals directly
            if (chiralCrystalsInput > 0) {
                chiralCrystalsResultDiv.innerHTML = formatResults("Chiral Crystals", { totalAmount: chiralCrystalsInput });
                chiralCrystalsResultDiv.classList.remove('hidden');
            }


            // Display results for each material if input > 0 or if there's a wasted amount
            // The condition now checks if there was any input or if any waste occurred, implying a calculation was made.
            if (resinsInput > 0 || resinsCalc.wasted > 0) {
                resinsResultDiv.innerHTML = formatResults("Resins", resinsCalc);
                resinsResultDiv.classList.remove('hidden');
            }
            if (metalsInput > 0 || metalsCalc.wasted > 0) {
                metalsResultDiv.innerHTML = formatResults("Metals", metalsCalc);
                metalsResultDiv.classList.remove('hidden');
            }
            if (ceramicsInput > 0 || ceramicsCalc.wasted > 0) {
                ceramicsResultDiv.innerHTML = formatResults("Ceramics", ceramicsCalc);
                ceramicsResultDiv.classList.remove('hidden');
            }
            if (chemicalsInput > 0 || chemicalsCalc.wasted > 0) {
                chemicalsResultDiv.innerHTML = formatResults("Chemicals", chemicalsCalc);
                chemicalsResultDiv.classList.remove('hidden');
            }
            if (specialAlloysInput > 0 || specialAlloysCalc.wasted > 0) {
                specialAlloysResultDiv.innerHTML = formatResults("Special Alloys", specialAlloysCalc);
                specialAlloysResultDiv.classList.remove('hidden');
            }


            // If no input was provided for any field, show a message
            if (resinsInput === 0 && metalsInput === 0 && ceramicsInput === 0 && chemicalsInput === 0 && specialAlloysInput === 0 && chiralCrystalsInput === 0) {
                showModalMessage("Please enter an amount for at least one material to calculate units.");
            }

            // Scroll to the results container after calculation
            document.getElementById('results-container').scrollIntoView({ behavior: 'smooth', block: 'start' });
        });

        // Event listener for the new reset button
        document.getElementById('resetBtn').addEventListener('click', resetCalculator);
    </script>
</body>
</html>
